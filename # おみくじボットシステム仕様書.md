# おみくじボットシステム仕様書

## 1. システム概要

本システムは、わんコメで使用する、生配信向けのおみくじボットを実装するためのシステムです。ユーザーのコメントに応じて、様々な条件でおみくじ結果を提供します。

## 2. 主要コンポーネント

### 2.1 基本構造 (OmikenType)

システムは以下の主要な要素で構成されています：

- **ルール管理** (`rules`): おみくじの発動条件と動作を定義
- **おみくじメッセージ** (`omikuji`): 実際の出力内容を管理
- **プレースホルダー** (`place`): 動的なテキスト置換機能
- **システム設定** (`preferences`): システム全体の動作設定

### 2.2 共通属性

すべての主要コンポーネントは以下の基本属性を持ちます：

- `id`: 一意の識別子
- `name`: 表示名
- `description`: 説明文

## 3. ルールシステム

### 3.1 ルール定義 (RulesType)

各ルールは以下の要素で構成されます：

- **色分け** (`color`): UI上での識別用カラー
- **発動条件** (`threshold`): 複数の条件タイプを指定可能
- **有効おみくじ** (`enabledIds`): このルールで使用可能なおみくじIDのリスト

### 3.2 発動条件タイプ

以下の条件タイプが利用可能です：

1. **キーワードマッチ** (`match`)
2. **役職権限** (`access`)
3. **カウント条件** (`count`)
4. **ギフト条件** (`gift`)
5. **初見判定** (`syoken`)
6. **タイマー** (`timer`)

## 4. おみくじメッセージシステム

### 4.1 メッセージ定義 (OmikujiType)

各おみくじメッセージは以下の要素で構成されます：

- **重み** (`weight`): 出現確率の重み付け
- **発動条件** (`threshold`): メッセージ固有の発動条件
- **投稿設定** (`post`): 複数の投稿方法を指定可能

### 4.2 投稿タイプ

以下の投稿方法に対応：

1. `onecomme`: わんコメへの投稿
2. `party`: WordPartyへの投稿
3. `toast`: トースト通知
4. `speech`: 音声読み上げ
5. status: ユーザーに対するステータスの付与

各投稿には以下の設定が必要：
- `botKey`: ボット識別子
- `iconKey`: アイコン識別子
- `delaySeconds`: 遅延時間
- hoge: status用、足すか引くか
- `content`: 投稿内容

## 5. 条件システム

### 5.1 アクセス権限レベル

以下の5段階のアクセス権限を定義：

0. `OFF`: 無効
1. `ANYONE`: 誰でも
2. `MEMBER`: メンバー
3. `MODERATOR`: モデレーター
4. `ADMIN`: 管理者

### 5.2 時間関連条件

- **時刻指定** (`clock`):
  - 開始時刻
  - 継続時間

- **経過時間** (`elapsed`):
  - 秒/分/時間/日単位
  - 最小/最大/範囲指定

### 5.3 カウント条件

以下の3種類のカウントに対応：

- `lc`: 配信枠の全体コメント数
- `no`: 配信枠の個人コメント数
- `tc`: 総数の個人コメント数

## 6. プレースホルダーシステム

### 6.1 プレースホルダータイプ

1. `single`: 単一値
2. `weight`: 重み付き複数値
3. `script`: 外部スクリプトによる動的生成

### 6.2 値の定義

- 重み付き値定義が可能
- 他のプレースホルダーへの参照可能 (`<<place_name>>`)

## 7. システム設定

以下の全体設定が可能：

- `basicDelay`: 基本応答遅延時間（秒）
- `omikujiCoolDown`: おみくじクールダウン時間（秒）
- `commentDuration`: コメント有効期間（秒）
- `BotUserIDname`: ボットのユーザーID

## 8. 補足事項

- すべての時間指定は秒単位で管理
- 条件の組み合わせによる複雑な制御が可能
- プレースホルダーによる柔軟なテキスト生成に対応
